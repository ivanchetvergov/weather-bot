# nlp_patterns.py

# Паттерны для SpaCy Matcher
# Каждый ключ словаря - это имя команды (например, "/weather").
# Значение - это список паттернов для этой команды.
# Каждый паттерн - это список словарей, описывающих токены.

NLP_PATTERNS = {
    "/weather": [
        # Какая погода в Москве? / Какая погода Москва?
        [{"LEMMA": "погода"}, {"LOWER": {"IN": ["в", "для"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}, {"LOWER": "сейчас", "OP": "?"}],
        [{"LEMMA": "какой"}, {"LEMMA": "погода"}, {"LOWER": {"IN": ["в", "для"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Что с погодой в СПб? / Как там погода в Лондоне?
        [{"LEMMA": {"IN": ["что", "как"]}}, {"LOWER": "там", "OP": "?"}, {"LOWER": {"IN": ["с", "по", "для"]}, "OP": "?"}, {"LEMMA": "погода"}, {"LOWER": {"IN": ["в", "для"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Покажи погоду в Нью-Йорке / Покажи погоду Нью-Йорк
        [{"LEMMA": "показывать"}, {"LEMMA": "погода"}, {"LOWER": {"IN": ["в", "для"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Погода Москва
        [{"LEMMA": "погода"}, {"POS": "PROPN"}],
        # В Москве сейчас какая погода?
        [{"LOWER": {"IN": ["в", "для"]}}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}, {"LOWER": "сейчас", "OP": "?"}, {"LEMMA": "какой", "OP": "?"}, {"LEMMA": "погода"}],
        # Погода в [город] на сегодня
        [{"LEMMA": "погода"}, {"LOWER": {"IN": ["в", "для"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}, {"LOWER": "на"}, {"LOWER": "сегодня"}],
        # Температура в [город]
        [{"LEMMA": "температура"}, {"LOWER": {"IN": ["в", "для"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Какой ветер в [город]?
        [{"LEMMA": "какой"}, {"LEMMA": "ветер"}, {"LOWER": {"IN": ["в", "для"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}]
    ],
    "/mycity": [
        [{"LOWER": {"IN": ["установить", "поставить", "сделать"]}, "OP": "?"},
         {"LOWER": {"IN": ["мой", "свой", "город"]}, "OP": "?"},
         {"LOWER": {"IN": ["по", "по-умолчанию", "по умолчанию", "дефолтный"]}, "OP": "?"},
         {"LOWER": "город"},
         {"ENT_TYPE": "CITY", "OP": "?"}], # Можно указать город явно
        [{"LOWER": {"IN": ["мой", "город", "дефолтный"]}, "OP": "?"},
         {"LOWER": {"IN": ["по умолчанию", "по-умолчанию"]}, "OP": "?"},
         {"ENT_TYPE": "CITY"} # Город как главная сущность
        ],
        [{"LOWER": {"IN": ["установить", "сделать", "поставить"]}, "OP": "?"},
         {"LOWER": "по умолчанию", "OP": "?"},
         {"ENT_TYPE": "CITY"}] # Простая форма: "Установить Москву по умолчанию"
    ],
    "/forecast": [
        # Прогноз на завтра в Питере
        [{"LEMMA": "прогноз"}, {"LOWER": "на"}, {"LOWER": {"IN": ["завтра", "послезавтра", "сегодня", "понедельник", "вторник", "среда", "четверг", "пятница", "суббота", "воскресенье"]}}, {"LOWER": {"IN": ["в", "для"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Прогноз погоды в Лондоне на послезавтра
        [{"LEMMA": "прогноз"}, {"LEMMA": "погода"}, {"LOWER": {"IN": ["в", "для"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}, {"LOWER": "на"}, {"LOWER": {"IN": ["завтра", "послезавтра", "сегодня", "понедельник", "вторник", "среда", "четверг", "пятница", "суббота", "воскресенье"]}}],
        # Когда будет дождь в Москве? / Будет ли дождь в Москве?
        [{"LEMMA": {"IN": ["когда", "быть"]}}, {"LEMMA": "быть", "OP": "?"}, {"LOWER": {"IN": ["ли"]}, "OP": "?"}, {"LOWER": {"IN": ["дождь", "снег", "солнце", "ветер", "осадки"]}}, {"LOWER": {"IN": ["в", "для"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Какой прогноз на пятницу в СПб?
        [{"LEMMA": "какой"}, {"LEMMA": "прогноз"}, {"LOWER": "на"}, {"LOWER": {"IN": ["понедельник", "вторник", "среда", "четверг", "пятница", "суббота", "воскресенье"]}}, {"LOWER": {"IN": ["в", "для"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Прогноз погоды в Москве / Прогноз в Москве
        [{"LEMMA": "прогноз"}, {"LEMMA": "погода", "OP": "?"}, {"LOWER": {"IN": ["в", "для"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Прогноз Москва завтра
        [{"LEMMA": "прогноз"}, {"POS": "PROPN"}, {"LOWER": {"IN": ["завтра", "послезавтра", "сегодня"]}}],
        # Прогноз на [день недели]
        [{"LEMMA": "прогноз"}, {"LOWER": "на"}, {"LOWER": {"IN": ["понедельник", "вторник", "среда", "четверг", "пятница", "суббота", "воскресенье"]}}],
        # Будет ли [погода] [город]
        [{"LEMMA": "быть"}, {"LOWER": "ли"}, {"LOWER": {"IN": ["дождь", "снег", "солнце", "ветер", "осадки"]}}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}]
    ],
    "/subscribe": [
        # Подписаться на погоду в Москве
        [{"LEMMA": {"IN": ["подписать", "подписаться"]}}, {"LOWER": "меня", "OP": "?"}, {"LOWER": "на"}, {"LEMMA": "погода", "OP": "?"}, {"LOWER": {"IN": ["в", "для"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Подписаться на дождь в Санкт-Петербурге
        [{"LEMMA": {"IN": ["подписать", "подписаться"]}}, {"LOWER": "меня", "OP": "?"}, {"LOWER": "на"}, {"LOWER": {"IN": ["дождь", "ветер", "температура", "осадки", "снег", "солнце"]}}, {"LOWER": {"IN": ["в", "для"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Хочу получать уведомления о погоде в Лондоне
        [{"LEMMA": "хотеть"}, {"LEMMA": "получать"}, {"LEMMA": "уведомление"}, {"LOWER": {"IN": ["о", "про"]}, "OP": "?"}, {"LEMMA": "погода", "OP": "?"}, {"LOWER": {"IN": ["в", "для"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Уведомлять меня о погоде в Париже
        [{"LEMMA": "уведомлять"}, {"LOWER": "меня", "OP": "?"}, {"LOWER": {"IN": ["о", "про"]}, "OP": "?"}, {"LEMMA": "погода", "OP": "?"}, {"LOWER": {"IN": ["в", "для"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Создать подписку на Москву
        [{"LEMMA": "создавать"}, {"LEMMA": "подписка"}, {"LOWER": "на"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Подписаться на погоду в [город] когда температура выше X
        [{"LEMMA": {"IN": ["подписать", "подписаться"]}}, {"LOWER": "на"}, {"LEMMA": "погода", "OP": "?"}, {"LOWER": {"IN": ["в", "для"]}, "OP": "?"}, {"POS": "PROPN"}, {"IS_ALPHA": True, "OP": "*"}, {"LOWER": "когда"}, {"LEMMA": "температура"}, {"LOWER": {"IN": ["выше", "больше"]}}, {"LIKE_NUM": True}],
        # Уведомления о дожде в [город]
        [{"LEMMA": "уведомление"}, {"LOWER": "о"}, {"LOWER": "дождь"}, {"LOWER": {"IN": ["в", "для"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}]
    ],
    "/unsubscribe": [
        # Отписаться от погоды в Москве
        [{"LEMMA": {"IN": ["отписать", "отписаться"]}}, {"LOWER": "от"}, {"LEMMA": "погода", "OP": "?"}, {"LOWER": {"IN": ["в", "для"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Не хочу получать уведомления из Питера
        [{"LEMMA": {"IN": ["не", "нет"]}}, {"LEMMA": "хотеть"}, {"LEMMA": "получать"}, {"LEMMA": "уведомление"}, {"LOWER": {"IN": ["из", "от", "по"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Удалить подписку на Лондон
        [{"LEMMA": "удалять"}, {"LEMMA": "подписка"}, {"LOWER": {"IN": ["на", "для", "от"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Остановить уведомления по Москве
        [{"LEMMA": "останавливать"}, {"LEMMA": "уведомление"}, {"LOWER": {"IN": ["по", "в", "для"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}]
    ],
    "/modify_subscription": [
        # Изменить подписку в Москве
        [{"LEMMA": {"IN": ["изменить", "обновить"]}}, {"LEMMA": "подписка"}, {"LOWER": {"IN": ["в", "для"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Обновить настройки уведомлений для Санкт-Петербурга
        [{"LEMMA": {"IN": ["обновить", "изменить", "скорректировать"]}}, {"LEMMA": "настройка"}, {"LEMMA": "уведомление"}, {"LOWER": {"IN": ["для", "по"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Добавить условие к подписке в Париже (например, "добавить условие дождь в Париже")
        [{"LEMMA": {"IN": ["добавить", "изменить"]}}, {"LEMMA": "условие"}, {"LOWER": {"IN": ["к", "в"]}, "OP": "?"}, {"LEMMA": "подписка"}, {"LOWER": {"IN": ["в", "для"]}, "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}]
    ],
    "/subscriptions": [ # Если у тебя есть такая команда для просмотра подписок
        # Мои подписки
        [{"LEMMA": "мой"}, {"LEMMA": "подписка"}],
        # Показать мои подписки
        [{"LEMMA": "показывать"}, {"LEMMA": "мой"}, {"LEMMA": "подписка"}],
        # Какие у меня есть подписки?
        [{"LEMMA": "какой"}, {"LOWER": "у"}, {"LEMMA": "я"}, {"LEMMA": "быть"}, {"LEMMA": "подписка"}],
        # Список моих подписок
        [{"LEMMA": "список"}, {"LEMMA": "мой"}, {"LEMMA": "подписка"}]
    ],
    "/start": [ # Добавим для полноты, если это может быть NLP-триггером
        [{"LEMMA": "начать"}],
        [{"LEMMA": "старт"}],
        [{"LEMMA": "привет"}], # Если приветствие должно триггерить старт
        [{"LEMMA": "начать"}, {"LEMMA": "диалог"}]
    ],
    "/help": [ # Если NLP может распознать запрос на помощь
        [{"LEMMA": "помощь"}],
        [{"LEMMA": "помогать"}],
        [{"LEMMA": "что"}, {"LEMMA": "ты"}, {"LEMMA": "мочь"}],
        [{"LEMMA": "доступный"}, {"LEMMA": "команда"}]
    ],
    "/greeting": [ # Для общих приветствий, если они не должны быть /start
        [{"LEMMA": "привет"}],
        [{"LEMMA": "здравствовать"}],
        [{"LEMMA": "добрый"}, {"LEMMA": "день"}],
        [{"LEMMA": "добрый"}, {"LEMMA": "утро"}],
        [{"LEMMA": "добрый"}, {"LEMMA": "вечер"}]
    ],
    "/thanks": [
        [{"LEMMA": "спасибо"}],
        [{"LEMMA": "благодарить"}],
        [{"LEMMA": "большой"}, {"LEMMA": "спасибо"}]
    ]
}

# --- Вспомогательные данные для извлечения сущностей ---

KNOWN_CITIES = [
    "москва", "санкт-петербург", "спб", "питер", "лондон", "нью-йорк", "париж",
    "берлин", "рим", "токио", "пекин", "сидней", "дубай", "стамбул", "киев",
    "минск", "ташкент", "алматы", "сочи", "казань", "новосибирск", "екатеринбург",
    "краснодар", "нижний новгород", "самара", "омск", "челябинск", "уфа", "пермь",
    "волгоград", "ростов-на-дону", "воронеж", "красноярск", "владивосток", "хабаровск",
    "калининград", "кемерово", "уфа", "казань", "иркутск", "тюмень", "саратов", "тольятти", 
    "барнаул", "ижевск"
]

CONDITION_KEYWORDS = {
    "дождь": "rain",
    "ливень": "heavy_rain",
    "ветер": "wind",
    "сильный ветер": "strong_wind",
    "температура": "temperature",
    "жара": "hot_temperature",
    "холод": "cold_temperature",
    "осадки": "precipitation",
    "солнце": "clear_sky", 
    "ясно": "clear_sky",
    "снег": "snow",
    "метель": "blizzard",
    "пасмурно": "cloudy",
    "туман": "fog"
}

DAY_MAPPINGS = {
    "понедельник": 0,
    "вторник": 1,
    "среда": 2,
    "четверг": 3,
    "пятница": 4,
    "суббота": 5,
    "воскресенье": 6
}