# nlp_patterns.py

# Паттерны для SpaCy Matcher
# Каждый ключ словаря - это имя интента.
# Значение - это список паттернов для этого интента.
# Каждый паттерн - это список словарей, описывающих токены.

NLP_PATTERNS = {
    "GET_WEATHER": [
        # Какая погода в Москве?
        [{"LEMMA": "погода"}, {"LOWER": "в"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        [{"LEMMA": "какой"}, {"LEMMA": "погода"}, {"LOWER": "в"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Что с погодой в СПб? / Как там погода в Лондоне?
        [{"LEMMA": {"IN": ["что", "как"]}}, {"LOWER": "там", "OP": "?"}, {"LOWER": "с", "OP": "?"}, {"LEMMA": "погода"}, {"LOWER": "в"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Покажи погоду в Нью-Йорке
        [{"LEMMA": "показывать"}, {"LEMMA": "погода"}, {"LOWER": "в"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Погода Москва
        [{"LEMMA": "погода"}, {"POS": "PROPN"}],
        # В Москве сейчас какая погода?
        [{"LOWER": "в"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}, {"LOWER": "сейчас", "OP": "?"}, {"LEMMA": "какой", "OP": "?"}, {"LEMMA": "погода"}]
    ],
    "GET_FORECAST": [
        # Прогноз на завтра в Питере
        [{"LEMMA": "прогноз"}, {"LOWER": "на"}, {"LOWER": {"IN": ["завтра", "послезавтра", "сегодня", "понедельник", "вторник", "среда", "четверг", "пятница", "суббота", "воскресенье"]}}, {"LOWER": "в", "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Прогноз погоды в Лондоне на послезавтра
        [{"LEMMA": "прогноз"}, {"LEMMA": "погода"}, {"LOWER": "в"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}, {"LOWER": "на"}, {"LOWER": {"IN": ["завтра", "послезавтра", "сегодня", "понедельник", "вторник", "среда", "четверг", "пятница", "суббота", "воскресенье"]}}],
        # Когда будет дождь в Москве? (для будущих расширений)
        [{"LEMMA": "когда"}, {"LEMMA": "быть"}, {"LOWER": {"IN": ["дождь", "снег", "солнце", "ветер"]}}, {"LOWER": "в"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Какой прогноз на пятницу в СПб?
        [{"LEMMA": "какой"}, {"LEMMA": "прогноз"}, {"LOWER": "на"}, {"LOWER": {"IN": ["понедельник", "вторник", "среда", "четверг", "пятница", "суббота", "воскресенье"]}}, {"LOWER": "в", "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Прогноз погоды в Москве
        [{"LEMMA": "прогноз"}, {"LEMMA": "погода"}, {"LOWER": "в"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Прогноз Москва завтра
        [{"LEMMA": "прогноз"}, {"POS": "PROPN"}, {"LOWER": {"IN": ["завтра", "послезавтра", "сегодня"]}}]
    ],
    "SUBSCRIBE": [
        # Подписаться на погоду в Москве
        [{"LEMMA": {"IN": ["подписать", "подписаться"]}}, {"LOWER": "меня", "OP": "?"}, {"LOWER": "на"}, {"LEMMA": "погода", "OP": "?"}, {"LOWER": "в"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Подписаться на дождь в Санкт-Петербурге
        [{"LEMMA": {"IN": ["подписать", "подписаться"]}}, {"LOWER": "меня", "OP": "?"}, {"LOWER": "на"}, {"LOWER": {"IN": ["дождь", "ветер", "температура", "осадки"]}}, {"LOWER": "в"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Хочу получать уведомления о погоде в Лондоне
        [{"LEMMA": "хотеть"}, {"LEMMA": "получать"}, {"LEMMA": "уведомление"}, {"LOWER": "о", "OP": "?"}, {"LEMMA": "погода"}, {"LOWER": "в"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Уведомлять меня о погоде в Париже
        [{"LEMMA": "уведомлять"}, {"LOWER": "меня"}, {"LOWER": "о"}, {"LEMMA": "погода"}, {"LOWER": "в"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Создать подписку на Москву
        [{"LEMMA": "создавать"}, {"LEMMA": "подписка"}, {"LOWER": "на"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}]
    ],
    "UNSUBSCRIBE": [
        # Отписаться от погоды в Москве
        [{"LEMMA": {"IN": ["отписать", "отписаться"]}}, {"LOWER": "от"}, {"LEMMA": "погода", "OP": "?"}, {"LOWER": "в"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Не хочу получать уведомления из Питера
        [{"LEMMA": {"IN": ["не", "нет"]}}, {"LEMMA": "хотеть"}, {"LEMMA": "получать"}, {"LEMMA": "уведомление"}, {"LOWER": "из", "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Удалить подписку на Лондон
        [{"LEMMA": "удалять"}, {"LEMMA": "подписка"}, {"LOWER": "на", "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Остановить уведомления по Москве
        [{"LEMMA": "останавливать"}, {"LEMMA": "уведомление"}, {"LOWER": "по"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}]
    ],
    "MODIFY_SUBSCRIPTION": [
        # Изменить подписку в Москве
        [{"LEMMA": {"IN": ["изменить", "обновить"]}}, {"LEMMA": "подписка"}, {"LOWER": "в", "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Обновить настройки уведомлений для Санкт-Петербурга
        [{"LEMMA": {"IN": ["обновить", "изменить"]}}, {"LEMMA": "настройка"}, {"LEMMA": "уведомление"}, {"LOWER": "для", "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}],
        # Добавить условие к подписке в Париже (например, "добавить условие дождь в Париже")
        [{"LEMMA": {"IN": ["добавить", "изменить"]}}, {"LEMMA": "условие"}, {"LOWER": "к", "OP": "?"}, {"LEMMA": "подписка"}, {"LOWER": "в", "OP": "?"}, {"POS": "PROPN", "OP": "*"}, {"IS_ALPHA": True, "OP": "*"}]
    ],
    "GET_SUBSCRIPTIONS": [
        # Мои подписки
        [{"LEMMA": "мой"}, {"LEMMA": "подписка"}],
        # Показать мои подписки
        [{"LEMMA": "показывать"}, {"LEMMA": "мой"}, {"LEMMA": "подписка"}],
        # Какие у меня есть подписки?
        [{"LEMMA": "какой"}, {"LOWER": "у"}, {"LEMMA": "я"}, {"LEMMA": "быть"}, {"LEMMA": "подписка"}],
        # Список моих подписок
        [{"LEMMA": "список"}, {"LEMMA": "мой"}, {"LEMMA": "подписка"}]
    ]
}

# --- Вспомогательные данные для извлечения сущностей ---

KNOWN_CITIES = [
    "москва", "санкт-петербург", "спб", "питер", "лондон", "нью-йорк", "париж",
    "берлин", "рим", "токио", "пекин", "сидней", "дубай", "стамбул", "киев",
    "минск", "ташкент", "алматы", "сочи", "казань", "новосибирск", "екатеринбург"
]

CONDITION_KEYWORDS = {
    "дождь": "rain",
    "ветер": "wind",
    "температура": "temperature",
    "осадки": "precipitation",
    "солнце": "clear_sky", # Для оповещений о ясной погоде
    "снег": "snow"
}

DAY_MAPPINGS = {
    "понедельник": 0,
    "вторник": 1,
    "среда": 2,
    "четверг": 3,
    "пятница": 4,
    "суббота": 5,
    "воскресенье": 6
}