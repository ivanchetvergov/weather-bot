2025-07-11 16:31:48,301 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.
2025-07-11 16:31:48,392 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data
2025-07-11 16:31:48,414 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962
2025-07-11 16:31:49,024 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data
2025-07-11 16:31:49,040 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962
2025-07-11 16:31:49,044 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.
2025-07-11 16:31:49,049 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.
2025-07-11 16:31:49,049 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.
2025-07-11 16:31:54,957 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.
2025-07-11 16:31:55,036 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data
2025-07-11 16:31:55,049 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962
2025-07-11 16:31:55,453 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data
2025-07-11 16:31:55,466 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962
2025-07-11 16:31:55,469 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.
2025-07-11 16:31:55,472 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.
2025-07-11 16:31:55,472 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.
2025-07-11 16:32:00,942 - nlp_spacy.nlp_app - INFO - Received request for text: 'город по умолчанию москва'
2025-07-11 16:32:00,975 - nlp_spacy.nlp_app - INFO - Processed text: 'город по умолчанию москва', result: {'command': '/mycity', 'entities': {'city': 'Москва'}}
2025-07-11 16:42:37,686 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.
2025-07-11 16:42:37,776 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data
2025-07-11 16:42:37,796 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962
2025-07-11 16:42:38,243 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data
2025-07-11 16:42:38,257 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962
2025-07-11 16:42:38,260 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.
2025-07-11 16:42:38,263 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.
2025-07-11 16:42:38,263 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.
2025-07-11 16:42:42,039 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.
2025-07-11 16:42:42,066 - python_bot.kafka_service - INFO - Kafka Producer connected to localhost:9092, topic='bot_commands'
2025-07-11 16:42:42,066 - python_bot.kafka_service - INFO - Kafka Consumer subscribed to topic 'bot_responses'
2025-07-11 16:42:42,067 - __main__ - INFO - Kafka Response Listener starting in separate thread.
2025-07-11 16:42:42,067 - __main__ - INFO - Telegram bot started polling...
2025-07-11 16:42:42,240 - python_bot.commands - INFO - Telegram commands set successfully.
2025-07-11 16:42:42,240 - __main__ - INFO - Telegram bot setup complete.
2025-07-11 16:42:42,280 - telegram.ext.Application - INFO - Application started
2025-07-11 16:42:48,140 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'погода'
2025-07-11 16:42:48,149 - nlp_spacy.nlp_app - INFO - Received request for text: 'погода'
2025-07-11 16:42:48,172 - nlp_spacy.nlp_app - INFO - Processed text: 'погода', result: {'command': '/weather', 'entities': {}}
2025-07-11 16:42:48,174 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /weather, entities: {}
2025-07-11 16:42:48,174 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752241368, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/weather", "original_text": "погода", "entities": {}}}
2025-07-11 16:42:48,174 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'
2025-07-11 16:42:48,421 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Погода в городе Кемерово:
небольшой дождь
Температ...
2025-07-11 16:43:23,786 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'установи город по умолчанию спб'
2025-07-11 16:43:23,796 - nlp_spacy.nlp_app - INFO - Received request for text: 'установи город по умолчанию спб'
2025-07-11 16:43:23,814 - nlp_spacy.nlp_app - INFO - Processed text: 'установи город по умолчанию спб', result: {'command': '/mycity', 'entities': {'city': 'Спб'}}
2025-07-11 16:43:23,815 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /mycity, entities: {'city': 'Спб'}
2025-07-11 16:43:23,815 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752241399, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/mycity", "original_text": "установи город по умолчанию спб", "entities": {"city": "Спб"}}}
2025-07-11 16:43:23,815 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'
2025-07-11 16:43:23,835 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Пожалуйста, укажите город для установки по умолчан...
2025-07-11 16:43:44,144 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'город по умолчанию питер'
2025-07-11 16:43:44,151 - nlp_spacy.nlp_app - INFO - Received request for text: 'город по умолчанию питер'
2025-07-11 16:43:44,165 - nlp_spacy.nlp_app - INFO - Processed text: 'город по умолчанию питер', result: {'command': '/mycity', 'entities': {'city': 'Питер'}}
2025-07-11 16:43:44,167 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /mycity, entities: {'city': 'Питер'}
2025-07-11 16:43:44,167 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752241420, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/mycity", "original_text": "город по умолчанию питер", "entities": {"city": "Питер"}}}
2025-07-11 16:43:44,167 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'
2025-07-11 16:43:44,194 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Пожалуйста, укажите город для установки по умолчан...
2025-07-11 16:43:52,477 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'город по умолчанию кемерово'
2025-07-11 16:43:52,482 - nlp_spacy.nlp_app - INFO - Received request for text: 'город по умолчанию кемерово'
2025-07-11 16:43:52,496 - nlp_spacy.nlp_app - INFO - Processed text: 'город по умолчанию кемерово', result: {'command': '/mycity', 'entities': {'city': 'Кемерово'}}
2025-07-11 16:43:52,498 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /mycity, entities: {'city': 'Кемерово'}
2025-07-11 16:43:52,498 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752241432, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/mycity", "original_text": "город по умолчанию кемерово", "entities": {"city": "Кемерово"}}}
2025-07-11 16:43:52,498 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'
2025-07-11 16:43:52,524 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Пожалуйста, укажите город для установки по умолчан...
2025-07-11 16:43:59,770 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'погода кемерово'
2025-07-11 16:43:59,776 - nlp_spacy.nlp_app - INFO - Received request for text: 'погода кемерово'
2025-07-11 16:43:59,787 - nlp_spacy.nlp_app - INFO - Processed text: 'погода кемерово', result: {'command': '/weather', 'entities': {'city': 'Кемерово'}}
2025-07-11 16:43:59,792 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /weather, entities: {'city': 'Кемерово'}
2025-07-11 16:43:59,792 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752241439, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/weather", "original_text": "погода кемерово", "entities": {"city": "Кемерово"}}}
2025-07-11 16:43:59,792 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'
2025-07-11 16:43:59,978 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Погода в городе Кемерово:
небольшой дождь
Температ...
2025-07-11 16:46:25,479 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.
--------------------------------------------------------------------------------
2025-07-11 16:46:25,563 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data
--------------------------------------------------------------------------------
2025-07-11 16:46:25,584 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962
--------------------------------------------------------------------------------
2025-07-11 16:46:26,053 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data
--------------------------------------------------------------------------------
2025-07-11 16:46:26,066 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962
--------------------------------------------------------------------------------
2025-07-11 16:46:26,069 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.
--------------------------------------------------------------------------------
2025-07-11 16:46:26,072 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.
--------------------------------------------------------------------------------
2025-07-11 16:46:26,072 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.
--------------------------------------------------------------------------------
2025-07-11 16:46:30,292 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
2025-07-11 16:46:30,293 - telegram.ext.Application - INFO - Application.stop() complete
2025-07-11 16:46:30,295 - __main__ - INFO - Closing Kafka consumer and NLP HTTP client...
2025-07-11 16:46:30,326 - python_bot.kafka_service - INFO - Kafka Consumer closed.
2025-07-11 16:46:31,785 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.
--------------------------------------------------------------------------------
2025-07-11 16:46:31,801 - python_bot.kafka_service - INFO - Kafka Producer connected to localhost:9092, topic='bot_commands'
--------------------------------------------------------------------------------
2025-07-11 16:46:31,801 - python_bot.kafka_service - INFO - Kafka Consumer subscribed to topic 'bot_responses'
--------------------------------------------------------------------------------
2025-07-11 16:46:31,801 - __main__ - INFO - Kafka Response Listener starting in separate thread.
--------------------------------------------------------------------------------
2025-07-11 16:46:31,801 - __main__ - INFO - Telegram bot started polling...
--------------------------------------------------------------------------------
2025-07-11 16:46:31,985 - python_bot.commands - INFO - Telegram commands set successfully.
--------------------------------------------------------------------------------
2025-07-11 16:46:31,985 - __main__ - INFO - Telegram bot setup complete.
--------------------------------------------------------------------------------
2025-07-11 16:46:32,025 - telegram.ext.Application - INFO - Application started
--------------------------------------------------------------------------------
2025-07-11 16:46:37,907 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
--------------------------------------------------------------------------------
2025-07-11 16:46:37,908 - telegram.ext.Application - INFO - Application.stop() complete
--------------------------------------------------------------------------------
2025-07-11 16:46:37,909 - __main__ - INFO - Closing Kafka consumer and NLP HTTP client...
--------------------------------------------------------------------------------
2025-07-11 16:46:37,916 - python_bot.kafka_service - INFO - Kafka Consumer closed.
--------------------------------------------------------------------------------
2025-07-11 16:46:37,917 - python_bot.nlp_client - INFO - HTTP client for NLP service closed.
--------------------------------------------------------------------------------
2025-07-11 16:46:37,918 - __main__ - INFO - Application shut down cleanly.
--------------------------------------------------------------------------------
2025-07-11 16:46:39,506 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.
--------------------------------------------------------------------------------
2025-07-11 16:46:39,519 - python_bot.kafka_service - INFO - Kafka Producer connected to localhost:9092, topic='bot_commands'
--------------------------------------------------------------------------------
2025-07-11 16:46:39,519 - python_bot.kafka_service - INFO - Kafka Consumer subscribed to topic 'bot_responses'
--------------------------------------------------------------------------------
2025-07-11 16:46:39,519 - __main__ - INFO - Kafka Response Listener starting in separate thread.
--------------------------------------------------------------------------------
2025-07-11 16:46:39,520 - __main__ - INFO - Telegram bot started polling...
--------------------------------------------------------------------------------
2025-07-11 16:46:39,695 - python_bot.commands - INFO - Telegram commands set successfully.
--------------------------------------------------------------------------------
2025-07-11 16:46:39,695 - __main__ - INFO - Telegram bot setup complete.
--------------------------------------------------------------------------------
2025-07-11 16:46:39,736 - telegram.ext.Application - INFO - Application started
--------------------------------------------------------------------------------
2025-07-11 16:46:47,564 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'погода кемерово'
--------------------------------------------------------------------------------
2025-07-11 16:46:47,574 - nlp_spacy.nlp_app - INFO - Received request for text: 'погода кемерово'
--------------------------------------------------------------------------------
2025-07-11 16:46:47,588 - nlp_spacy.nlp_app - INFO - Processed text: 'погода кемерово', result: {'command': '/weather', 'entities': {'city': 'Кемерово'}}
--------------------------------------------------------------------------------
2025-07-11 16:46:47,589 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /weather, entities: {'city': 'Кемерово'}
--------------------------------------------------------------------------------
2025-07-11 16:46:47,589 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752241607, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/weather", "original_text": "погода кемерово", "entities": {"city": "Кемерово"}}}
--------------------------------------------------------------------------------
2025-07-11 16:46:47,589 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'
--------------------------------------------------------------------------------
2025-07-11 16:46:47,766 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Погода в городе Кемерово:
небольшой дождь
Температ...
--------------------------------------------------------------------------------
2025-07-11 16:47:33,945 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:47:34,033 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:47:34,056 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:47:34,517 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:47:34,531 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:47:34,534 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.

2025-07-11 16:47:34,538 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.

2025-07-11 16:47:34,538 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.

2025-07-11 16:49:43,950 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:49:44,034 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:49:44,054 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:49:44,501 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:49:44,514 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:49:44,517 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.

2025-07-11 16:49:44,521 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.

2025-07-11 16:49:44,521 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.

2025-07-11 16:49:51,152 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:49:51,228 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:49:51,241 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:49:51,613 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:49:51,625 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:49:51,628 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.

2025-07-11 16:49:51,632 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.

2025-07-11 16:49:51,632 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.

2025-07-11 16:49:58,524 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:49:58,599 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:49:58,611 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:49:58,987 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:49:58,999 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:49:59,002 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.

2025-07-11 16:49:59,006 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.

2025-07-11 16:49:59,006 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.

2025-07-11 16:50:02,541 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
--------------------------------------------------------------------------------
2025-07-11 16:50:02,542 - telegram.ext.Application - INFO - Application.stop() complete
--------------------------------------------------------------------------------
2025-07-11 16:50:02,543 - __main__ - INFO - Closing Kafka consumer and NLP HTTP client...
--------------------------------------------------------------------------------
2025-07-11 16:50:02,570 - python_bot.kafka_service - INFO - Kafka Consumer closed.
--------------------------------------------------------------------------------
2025-07-11 16:50:04,092 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:50:04,106 - python_bot.kafka_service - INFO - Kafka Producer connected to localhost:9092, topic='bot_commands'

2025-07-11 16:50:04,107 - python_bot.kafka_service - INFO - Kafka Consumer subscribed to topic 'bot_responses'

2025-07-11 16:50:04,107 - __main__ - INFO - Kafka Response Listener starting in separate thread.

2025-07-11 16:50:04,107 - __main__ - INFO - Telegram bot started polling...

2025-07-11 16:50:04,302 - python_bot.commands - INFO - Telegram commands set successfully.

2025-07-11 16:50:04,302 - __main__ - INFO - Telegram bot setup complete.

2025-07-11 16:50:04,343 - telegram.ext.Application - INFO - Application started

2025-07-11 16:50:13,020 - python_bot.nlp_text_handler - INFO - ================================================================================

2025-07-11 16:50:13,021 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'погода'

2025-07-11 16:50:13,028 - nlp_spacy.nlp_app - INFO - Received request for text: 'погода'

2025-07-11 16:50:13,043 - nlp_spacy.nlp_app - INFO - Processed text: 'погода', result: {'command': '/weather', 'entities': {}}

2025-07-11 16:50:13,044 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /weather, entities: {}

2025-07-11 16:50:13,044 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752241813, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/weather", "original_text": "погода", "entities": {}}}

2025-07-11 16:50:13,044 - python_bot.nlp_text_handler - INFO - ================================================================================

2025-07-11 16:50:13,045 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 16:50:13,228 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Погода в городе Кемерово:
небольшой дождь
Температ...

2025-07-11 16:50:20,285 - python_bot.nlp_text_handler - INFO - ================================================================================

2025-07-11 16:50:20,285 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'погода'

2025-07-11 16:50:20,290 - nlp_spacy.nlp_app - INFO - Received request for text: 'погода'

2025-07-11 16:50:20,300 - nlp_spacy.nlp_app - INFO - Processed text: 'погода', result: {'command': '/weather', 'entities': {}}

2025-07-11 16:50:20,302 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /weather, entities: {}

2025-07-11 16:50:20,302 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752241820, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/weather", "original_text": "погода", "entities": {}}}

2025-07-11 16:50:20,302 - python_bot.nlp_text_handler - INFO - ================================================================================

2025-07-11 16:50:20,302 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 16:50:20,477 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Погода в городе Кемерово:
небольшой дождь
Температ...

2025-07-11 16:51:04,328 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:51:04,412 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:51:04,433 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:51:04,890 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:51:04,902 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:51:04,905 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.

2025-07-11 16:51:04,909 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.

2025-07-11 16:51:04,909 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.

2025-07-11 16:51:10,478 - __main__ - INFO - Bot stopped by user via KeyboardInterrupt.

2025-07-11 16:51:10,479 - __main__ - INFO - Closing Kafka consumer and NLP HTTP client...

2025-07-11 16:51:10,498 - python_bot.kafka_service - INFO - Kafka Consumer closed.

2025-07-11 16:51:12,043 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:51:12,058 - python_bot.kafka_service - INFO - Kafka Producer connected to localhost:9092, topic='bot_commands'

2025-07-11 16:51:12,058 - python_bot.kafka_service - INFO - Kafka Consumer subscribed to topic 'bot_responses'

2025-07-11 16:51:12,058 - __main__ - INFO - Kafka Response Listener starting in separate thread.

2025-07-11 16:51:12,058 - __main__ - INFO - Telegram bot started polling...

2025-07-11 16:51:12,393 - python_bot.commands - INFO - Telegram commands set successfully.

2025-07-11 16:51:12,393 - __main__ - INFO - Telegram bot setup complete.

2025-07-11 16:51:12,435 - telegram.ext.Application - INFO - Application started

2025-07-11 16:51:16,055 - python_bot.nlp_text_handler - INFO - 
================================================================================

2025-07-11 16:51:16,056 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'погода'

2025-07-11 16:51:16,065 - nlp_spacy.nlp_app - INFO - Received request for text: 'погода'

2025-07-11 16:51:16,085 - nlp_spacy.nlp_app - INFO - Processed text: 'погода', result: {'command': '/weather', 'entities': {}}

2025-07-11 16:51:16,086 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /weather, entities: {}

2025-07-11 16:51:16,087 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752241876, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/weather", "original_text": "погода", "entities": {}}}

2025-07-11 16:51:16,087 - python_bot.nlp_text_handler - INFO - 
================================================================================

2025-07-11 16:51:16,087 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 16:51:16,319 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Погода в городе Кемерово:
небольшой дождь
Температ...

2025-07-11 16:51:53,985 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:51:54,077 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:51:54,099 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:51:54,551 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:51:54,563 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:51:54,566 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.

2025-07-11 16:51:54,570 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.

2025-07-11 16:51:54,570 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.

2025-07-11 16:51:56,289 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:51:56,366 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:51:56,379 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:51:56,767 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:51:56,779 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:51:56,782 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.

2025-07-11 16:51:56,785 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.

2025-07-11 16:51:56,785 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.

2025-07-11 16:51:59,014 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.

2025-07-11 16:51:59,014 - telegram.ext.Application - INFO - Application.stop() complete

2025-07-11 16:51:59,015 - __main__ - INFO - Closing Kafka consumer and NLP HTTP client...

2025-07-11 16:51:59,025 - python_bot.kafka_service - INFO - Kafka Consumer closed.

2025-07-11 16:52:03,327 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:52:03,341 - python_bot.kafka_service - INFO - Kafka Producer connected to localhost:9092, topic='bot_commands'

2025-07-11 16:52:03,341 - python_bot.kafka_service - INFO - Kafka Consumer subscribed to topic 'bot_responses'

2025-07-11 16:52:03,341 - __main__ - INFO - Kafka Response Listener starting in separate thread.

2025-07-11 16:52:03,342 - __main__ - INFO - Telegram bot started polling...

2025-07-11 16:52:03,634 - python_bot.commands - INFO - Telegram commands set successfully.

2025-07-11 16:52:03,634 - __main__ - INFO - Telegram bot setup complete.

2025-07-11 16:52:03,677 - telegram.ext.Application - INFO - Application started

2025-07-11 16:52:05,926 - python_bot.nlp_text_handler - INFO - 
================================================================================


2025-07-11 16:52:05,926 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'погода'

2025-07-11 16:52:05,933 - nlp_spacy.nlp_app - INFO - Received request for text: 'погода'

2025-07-11 16:52:05,947 - nlp_spacy.nlp_app - INFO - Processed text: 'погода', result: {'command': '/weather', 'entities': {}}

2025-07-11 16:52:05,949 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /weather, entities: {}

2025-07-11 16:52:05,949 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752241925, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/weather", "original_text": "погода", "entities": {}}}

2025-07-11 16:52:05,949 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 16:52:06,179 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Погода в городе Кемерово:
небольшой дождь
Температ...

2025-07-11 16:52:16,696 - python_bot.nlp_text_handler - INFO - 
================================================================================


2025-07-11 16:52:16,697 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'город по умолчанию мск'

2025-07-11 16:52:16,703 - nlp_spacy.nlp_app - INFO - Received request for text: 'город по умолчанию мск'

2025-07-11 16:52:16,721 - nlp_spacy.nlp_app - INFO - Processed text: 'город по умолчанию мск', result: {'command': '/mycity', 'entities': {}}

2025-07-11 16:52:16,723 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /mycity, entities: {}

2025-07-11 16:52:16,724 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752241936, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/mycity", "original_text": "город по умолчанию мск", "entities": {}}}

2025-07-11 16:52:16,724 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 16:52:16,745 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Пожалуйста, укажите город для установки по умолчан...

2025-07-11 16:52:37,057 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:52:37,138 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:52:37,158 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:52:37,567 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:52:37,579 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:52:37,582 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.

2025-07-11 16:52:37,585 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.

2025-07-11 16:52:37,585 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.

2025-07-11 16:52:48,880 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:52:48,971 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:52:48,992 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:52:49,417 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:52:49,429 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:52:49,432 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.

2025-07-11 16:52:49,435 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.

2025-07-11 16:52:49,435 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.

2025-07-11 16:52:54,214 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:52:54,288 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:52:54,301 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:52:54,770 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:52:54,783 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:52:54,786 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.

2025-07-11 16:52:54,790 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.

2025-07-11 16:52:54,790 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.

2025-07-11 16:52:59,415 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.

2025-07-11 16:52:59,416 - telegram.ext.Application - INFO - Application.stop() complete

2025-07-11 16:52:59,417 - __main__ - INFO - Closing Kafka consumer and NLP HTTP client...

2025-07-11 16:52:59,441 - python_bot.kafka_service - INFO - Kafka Consumer closed.

2025-07-11 16:53:00,776 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:53:00,792 - python_bot.kafka_service - INFO - Kafka Producer connected to localhost:9092, topic='bot_commands'

2025-07-11 16:53:00,792 - python_bot.kafka_service - INFO - Kafka Consumer subscribed to topic 'bot_responses'

2025-07-11 16:53:00,792 - __main__ - INFO - Kafka Response Listener starting in separate thread.

2025-07-11 16:53:00,792 - __main__ - INFO - Telegram bot started polling...

2025-07-11 16:53:00,987 - python_bot.commands - INFO - Telegram commands set successfully.

2025-07-11 16:53:00,987 - __main__ - INFO - Telegram bot setup complete.

2025-07-11 16:53:01,030 - telegram.ext.Application - INFO - Application started

2025-07-11 16:53:06,637 - python_bot.nlp_text_handler - INFO - 


2025-07-11 16:53:06,638 - python_bot.nlp_text_handler - INFO - ================================================================================

2025-07-11 16:53:06,638 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'погода'

2025-07-11 16:53:06,646 - nlp_spacy.nlp_app - INFO - Received request for text: 'погода'

2025-07-11 16:53:06,661 - nlp_spacy.nlp_app - INFO - Processed text: 'погода', result: {'command': '/weather', 'entities': {}}

2025-07-11 16:53:06,662 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /weather, entities: {}

2025-07-11 16:53:06,662 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752241986, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/weather", "original_text": "погода", "entities": {}}}

2025-07-11 16:53:06,663 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 16:53:06,832 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Погода в городе Кемерово:
небольшой дождь
Температ...

2025-07-11 16:53:56,445 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:53:56,528 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:53:56,549 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:53:57,017 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:53:57,029 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:53:57,032 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.

2025-07-11 16:53:57,037 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.

2025-07-11 16:53:57,037 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.

2025-07-11 16:54:22,017 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:54:22,101 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:54:22,122 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:54:22,522 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:54:22,534 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:54:22,537 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.

2025-07-11 16:54:22,540 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.

2025-07-11 16:54:22,540 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.

2025-07-11 16:54:33,779 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:54:33,854 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:54:33,867 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:54:34,264 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:54:34,276 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:54:34,279 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.

2025-07-11 16:54:34,282 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.

2025-07-11 16:54:34,282 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.

2025-07-11 16:54:39,803 - __main__ - INFO - Bot stopped by user via KeyboardInterrupt.

2025-07-11 16:54:39,804 - __main__ - INFO - Closing Kafka consumer and NLP HTTP client...

2025-07-11 16:54:39,823 - python_bot.kafka_service - INFO - Kafka Consumer closed.

2025-07-11 16:54:41,540 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:54:41,555 - python_bot.kafka_service - INFO - Kafka Producer connected to localhost:9092, topic='bot_commands'

2025-07-11 16:54:41,555 - python_bot.kafka_service - INFO - Kafka Consumer subscribed to topic 'bot_responses'

2025-07-11 16:54:41,555 - __main__ - INFO - Kafka Response Listener starting in separate thread.

2025-07-11 16:54:41,556 - __main__ - INFO - Telegram bot started polling...

2025-07-11 16:54:41,831 - python_bot.commands - INFO - Telegram commands set successfully.

2025-07-11 16:54:41,831 - __main__ - INFO - Telegram bot setup complete.

2025-07-11 16:54:41,879 - telegram.ext.Application - INFO - Application started

2025-07-11 16:54:45,058 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'погода'

2025-07-11 16:54:45,065 - nlp_spacy.nlp_app - INFO - Received request for text: 'погода'

2025-07-11 16:54:45,079 - nlp_spacy.nlp_app - INFO - Processed text: 'погода', result: {'command': '/weather', 'entities': {}}

2025-07-11 16:54:45,081 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /weather, entities: {}

2025-07-11 16:54:45,081 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752242085, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/weather", "original_text": "погода", "entities": {}}}

2025-07-11 16:54:45,081 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 16:54:45,247 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Погода в городе Ке...

2025-07-11 16:55:15,305 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:55:15,389 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:55:15,409 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:55:15,812 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:55:15,824 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:55:15,827 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.

2025-07-11 16:55:15,830 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.

2025-07-11 16:55:15,830 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.

2025-07-11 16:55:21,903 - __main__ - INFO - Bot stopped by user via KeyboardInterrupt.

2025-07-11 16:55:21,903 - __main__ - INFO - Closing Kafka consumer and NLP HTTP client...

2025-07-11 16:55:21,916 - python_bot.kafka_service - INFO - Kafka Consumer closed.

2025-07-11 16:55:23,435 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:55:23,449 - python_bot.kafka_service - INFO - Kafka Producer connected to localhost:9092, topic='bot_commands'

2025-07-11 16:55:23,449 - python_bot.kafka_service - INFO - Kafka Consumer subscribed to topic 'bot_responses'

2025-07-11 16:55:23,449 - __main__ - INFO - Kafka Response Listener starting in separate thread.

2025-07-11 16:55:23,449 - __main__ - INFO - Telegram bot started polling...

2025-07-11 16:55:23,648 - python_bot.commands - INFO - Telegram commands set successfully.

2025-07-11 16:55:23,648 - __main__ - INFO - Telegram bot setup complete.

2025-07-11 16:55:23,780 - telegram.ext.Application - INFO - Application started

2025-07-11 16:55:27,525 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'погода'

2025-07-11 16:55:27,533 - nlp_spacy.nlp_app - INFO - Received request for text: 'погода'

2025-07-11 16:55:27,548 - nlp_spacy.nlp_app - INFO - Processed text: 'погода', result: {'command': '/weather', 'entities': {}}

2025-07-11 16:55:27,550 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /weather, entities: {}

2025-07-11 16:55:27,550 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752242127, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/weather", "original_text": "погода", "entities": {}}}

2025-07-11 16:55:27,550 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 16:55:27,716 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Погода в городе Ке...

2025-07-11 16:55:39,487 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:55:39,570 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:55:39,590 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:55:40,033 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:55:40,045 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:55:40,048 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.

2025-07-11 16:55:40,052 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.

2025-07-11 16:55:40,052 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.

2025-07-11 16:55:41,158 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.

2025-07-11 16:55:41,159 - telegram.ext.Application - INFO - Application.stop() complete

2025-07-11 16:55:41,160 - __main__ - INFO - Closing Kafka consumer and NLP HTTP client...

2025-07-11 16:55:41,176 - python_bot.kafka_service - INFO - Kafka Consumer closed.

2025-07-11 16:55:42,741 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:55:42,756 - python_bot.kafka_service - INFO - Kafka Producer connected to localhost:9092, topic='bot_commands'

2025-07-11 16:55:42,756 - python_bot.kafka_service - INFO - Kafka Consumer subscribed to topic 'bot_responses'

2025-07-11 16:55:42,756 - __main__ - INFO - Kafka Response Listener starting in separate thread.

2025-07-11 16:55:42,756 - __main__ - INFO - Telegram bot started polling...

2025-07-11 16:55:42,936 - python_bot.commands - INFO - Telegram commands set successfully.

2025-07-11 16:55:42,936 - __main__ - INFO - Telegram bot setup complete.

2025-07-11 16:55:42,978 - telegram.ext.Application - INFO - Application started

2025-07-11 16:55:50,584 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'погода'

2025-07-11 16:55:50,593 - nlp_spacy.nlp_app - INFO - Received request for text: 'погода'

2025-07-11 16:55:50,605 - nlp_spacy.nlp_app - INFO - Processed text: 'погода', result: {'command': '/weather', 'entities': {}}

2025-07-11 16:55:50,607 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /weather, entities: {}

2025-07-11 16:55:50,607 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752242150, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/weather", "original_text": "погода", "entities": {}}}

2025-07-11 16:55:50,607 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 16:55:50,776 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Погода в городе Ке...

2025-07-11 16:55:55,811 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'погода'

2025-07-11 16:55:55,818 - nlp_spacy.nlp_app - INFO - Received request for text: 'погода'

2025-07-11 16:55:55,828 - nlp_spacy.nlp_app - INFO - Processed text: 'погода', result: {'command': '/weather', 'entities': {}}

2025-07-11 16:55:55,830 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /weather, entities: {}

2025-07-11 16:55:55,831 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752242153, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/weather", "original_text": "погода", "entities": {}}}

2025-07-11 16:55:55,831 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 16:55:55,988 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Погода в городе Ке...

2025-07-11 16:56:00,997 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'привет'

2025-07-11 16:56:01,004 - nlp_spacy.nlp_app - INFO - Received request for text: 'привет'

2025-07-11 16:56:01,014 - nlp_spacy.nlp_app - INFO - Processed text: 'привет', result: {'command': 'unknown_text', 'entities': {}}

2025-07-11 16:56:01,017 - python_bot.nlp_text_handler - INFO - NLP recognized intent: unknown_text, entities: {}

2025-07-11 16:56:01,017 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752242158, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "unknown_text", "original_text": "привет", "entities": {}}}

2025-07-11 16:56:01,017 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 16:56:01,043 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Извините, эта кома...

2025-07-11 16:56:22,953 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 16:56:23,039 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:56:23,060 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:56:23,468 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 16:56:23,480 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 16:56:23,483 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.

2025-07-11 16:56:23,487 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.

2025-07-11 16:56:23,487 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.

2025-07-11 16:56:28,008 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'город по умолчанию кемерово'

2025-07-11 16:56:28,015 - nlp_spacy.nlp_app - INFO - Received request for text: 'город по умолчанию кемерово'

2025-07-11 16:56:28,029 - nlp_spacy.nlp_app - INFO - Processed text: 'город по умолчанию кемерово', result: {'command': '/mycity', 'entities': {'city': 'Кемерово'}}

2025-07-11 16:56:28,031 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /mycity, entities: {'city': 'Кемерово'}

2025-07-11 16:56:28,031 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752242187, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/mycity", "original_text": "город по умолчанию кемерово", "entities": {"city": "Кемерово"}}}

2025-07-11 16:56:28,031 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 16:56:28,056 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Пожалуйста, укажит...

2025-07-11 16:56:39,949 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.

2025-07-11 16:56:39,950 - telegram.ext.Application - INFO - Application.stop() complete

2025-07-11 16:56:39,950 - __main__ - INFO - Closing Kafka consumer and NLP HTTP client...

2025-07-11 16:56:39,961 - python_bot.kafka_service - INFO - Kafka Consumer closed.

2025-07-11 17:10:45,809 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 17:10:45,903 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 17:10:45,926 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 17:10:46,361 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 17:10:46,373 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 17:10:46,376 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.

2025-07-11 17:10:46,379 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.

2025-07-11 17:10:46,379 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.

2025-07-11 17:10:47,853 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 17:10:47,877 - python_bot.kafka_service - INFO - Kafka Producer connected to localhost:9092, topic='bot_commands'

2025-07-11 17:10:47,878 - python_bot.kafka_service - INFO - Kafka Consumer subscribed to topic 'bot_responses'

2025-07-11 17:10:47,878 - __main__ - INFO - Kafka Response Listener starting in separate thread.

2025-07-11 17:10:47,878 - __main__ - INFO - Telegram bot started polling...

2025-07-11 17:10:48,159 - python_bot.commands - INFO - Telegram commands set successfully.

2025-07-11 17:10:48,160 - __main__ - INFO - Telegram bot setup complete.

2025-07-11 17:10:48,210 - telegram.ext.Application - INFO - Application started

2025-07-11 17:10:54,058 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'привет'

2025-07-11 17:10:54,067 - nlp_spacy.nlp_app - INFO - Received request for text: 'привет'

2025-07-11 17:10:54,089 - nlp_spacy.nlp_app - INFO - Processed text: 'привет', result: {'command': 'unknown_text', 'entities': {}}

2025-07-11 17:10:54,090 - python_bot.nlp_text_handler - INFO - NLP recognized intent: unknown_text, entities: {}

2025-07-11 17:10:54,091 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752243053, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "unknown_text", "original_text": "привет", "entities": {}}}

2025-07-11 17:10:54,091 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 17:11:08,117 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'прогноз'

2025-07-11 17:11:08,124 - nlp_spacy.nlp_app - INFO - Received request for text: 'прогноз'

2025-07-11 17:11:08,134 - nlp_spacy.nlp_app - INFO - Processed text: 'прогноз', result: {'command': 'unknown_text', 'entities': {}}

2025-07-11 17:11:08,138 - python_bot.nlp_text_handler - INFO - NLP recognized intent: unknown_text, entities: {}

2025-07-11 17:11:08,138 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752243068, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "unknown_text", "original_text": "прогноз", "entities": {}}}

2025-07-11 17:11:08,139 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 17:11:34,628 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'погода кемерово'

2025-07-11 17:11:34,634 - nlp_spacy.nlp_app - INFO - Received request for text: 'погода кемерово'

2025-07-11 17:11:34,651 - nlp_spacy.nlp_app - INFO - Processed text: 'погода кемерово', result: {'command': '/weather', 'entities': {'city': 'Кемерово'}}

2025-07-11 17:11:34,653 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /weather, entities: {'city': 'Кемерово'}

2025-07-11 17:11:34,653 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752243094, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/weather", "original_text": "погода кемерово", "entities": {"city": "Кемерово"}}}

2025-07-11 17:11:34,653 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 17:12:21,005 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 17:12:21,087 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 17:12:21,107 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 17:12:21,510 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 17:12:21,523 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 17:12:21,526 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.

2025-07-11 17:12:21,530 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.

2025-07-11 17:12:21,530 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.

2025-07-11 17:12:30,045 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 17:12:30,119 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 17:12:30,132 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 17:12:30,582 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data

2025-07-11 17:12:30,594 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962

2025-07-11 17:12:30,597 - nlp_spacy.nlp_service - INFO - Added 72 EntityRuler patterns.

2025-07-11 17:12:30,600 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.

2025-07-11 17:12:30,600 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.

2025-07-11 17:12:31,127 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.

2025-07-11 17:12:31,127 - telegram.ext.Application - INFO - Application.stop() complete

2025-07-11 17:12:31,129 - __main__ - INFO - Closing Kafka consumer and NLP HTTP client...

2025-07-11 17:12:31,152 - python_bot.kafka_service - INFO - Kafka Consumer closed.

2025-07-11 17:12:32,158 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 17:12:32,172 - python_bot.kafka_service - INFO - Kafka Producer connected to localhost:9092, topic='bot_commands'

2025-07-11 17:12:32,173 - python_bot.kafka_service - INFO - Kafka Consumer subscribed to topic 'bot_responses'

2025-07-11 17:12:32,173 - __main__ - INFO - Kafka Response Listener starting in separate thread.

2025-07-11 17:12:32,173 - __main__ - INFO - Telegram bot started polling...

2025-07-11 17:12:32,429 - python_bot.commands - INFO - Telegram commands set successfully.

2025-07-11 17:12:32,429 - __main__ - INFO - Telegram bot setup complete.

2025-07-11 17:12:32,472 - telegram.ext.Application - INFO - Application started

2025-07-11 17:12:36,900 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'прогноз'

2025-07-11 17:12:36,905 - nlp_spacy.nlp_app - INFO - Received request for text: 'прогноз'

2025-07-11 17:12:36,916 - nlp_spacy.nlp_app - INFO - Processed text: 'прогноз', result: {'command': 'unknown_text', 'entities': {}}

2025-07-11 17:12:36,918 - python_bot.nlp_text_handler - INFO - NLP recognized intent: unknown_text, entities: {}

2025-07-11 17:12:36,918 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752243156, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "unknown_text", "original_text": "прогноз", "entities": {}}}

2025-07-11 17:12:36,918 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 17:12:45,091 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'погода'

2025-07-11 17:12:45,096 - nlp_spacy.nlp_app - INFO - Received request for text: 'погода'

2025-07-11 17:12:45,108 - nlp_spacy.nlp_app - INFO - Processed text: 'погода', result: {'command': '/weather', 'entities': {}}

2025-07-11 17:12:45,110 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /weather, entities: {}

2025-07-11 17:12:45,110 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752243165, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/weather", "original_text": "погода", "entities": {}}}

2025-07-11 17:12:45,110 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 17:12:56,811 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'прогноз кемерово'

2025-07-11 17:12:56,817 - nlp_spacy.nlp_app - INFO - Received request for text: 'прогноз кемерово'

2025-07-11 17:12:56,833 - nlp_spacy.nlp_app - INFO - Processed text: 'прогноз кемерово', result: {'command': '/mycity', 'entities': {'city': 'Кемерово'}}

2025-07-11 17:12:56,835 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /mycity, entities: {'city': 'Кемерово'}

2025-07-11 17:12:56,835 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752243176, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/mycity", "original_text": "прогноз кемерово", "entities": {"city": "Кемерово"}}}

2025-07-11 17:12:56,835 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 17:13:17,140 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'погодаэ'

2025-07-11 17:13:17,146 - nlp_spacy.nlp_app - INFO - Received request for text: 'погодаэ'

2025-07-11 17:13:17,157 - nlp_spacy.nlp_app - INFO - Processed text: 'погодаэ', result: {'command': 'unknown_text', 'entities': {}}

2025-07-11 17:13:17,159 - python_bot.nlp_text_handler - INFO - NLP recognized intent: unknown_text, entities: {}

2025-07-11 17:13:17,159 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752243194, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "unknown_text", "original_text": "погодаэ", "entities": {}}}

2025-07-11 17:13:17,160 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 17:13:28,005 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'прогноз'

2025-07-11 17:13:28,011 - nlp_spacy.nlp_app - INFO - Received request for text: 'прогноз'

2025-07-11 17:13:28,020 - nlp_spacy.nlp_app - INFO - Processed text: 'прогноз', result: {'command': 'unknown_text', 'entities': {}}

2025-07-11 17:13:28,023 - python_bot.nlp_text_handler - INFO - NLP recognized intent: unknown_text, entities: {}

2025-07-11 17:13:28,023 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752243207, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "unknown_text", "original_text": "прогноз", "entities": {}}}

2025-07-11 17:13:28,023 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 17:13:48,451 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'город по умолчанию кемерово'

2025-07-11 17:13:48,467 - nlp_spacy.nlp_app - INFO - Received request for text: 'город по умолчанию кемерово'

2025-07-11 17:13:48,475 - nlp_spacy.nlp_app - INFO - Processed text: 'город по умолчанию кемерово', result: {'command': '/mycity', 'entities': {'city': 'Кемерово'}}

2025-07-11 17:13:48,475 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /mycity, entities: {'city': 'Кемерово'}

2025-07-11 17:13:48,475 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752243225, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/mycity", "original_text": "город по умолчанию кемерово", "entities": {"city": "Кемерово"}}}

2025-07-11 17:13:48,475 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 17:13:59,356 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'прогноз погоды'

2025-07-11 17:13:59,362 - nlp_spacy.nlp_app - INFO - Received request for text: 'прогноз погоды'

2025-07-11 17:13:59,374 - nlp_spacy.nlp_app - INFO - Processed text: 'прогноз погоды', result: {'command': '/forecast', 'entities': {}}

2025-07-11 17:13:59,376 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /forecast, entities: {}

2025-07-11 17:13:59,376 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752243239, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/forecast", "original_text": "прогноз погоды", "entities": {}}}

2025-07-11 17:13:59,377 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'

2025-07-11 17:14:27,294 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.

2025-07-11 17:14:27,295 - telegram.ext.Application - INFO - Application.stop() complete

2025-07-11 17:14:27,297 - __main__ - INFO - Closing Kafka consumer and NLP HTTP client...

2025-07-11 17:14:27,308 - python_bot.kafka_service - INFO - Kafka Consumer closed.

2025-07-11 17:17:40,555 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 17:19:03,889 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 17:19:03,913 - python_bot.kafka_service - INFO - Kafka Producer connected to localhost:9092, topic='bot_commands'

2025-07-11 17:19:03,913 - python_bot.kafka_service - INFO - Kafka Consumer subscribed to topic 'bot_responses'

2025-07-11 17:19:03,914 - __main__ - INFO - Kafka Response Listener starting in separate thread.

2025-07-11 17:19:03,914 - __main__ - INFO - Telegram bot started polling...

2025-07-11 17:19:04,357 - python_bot.commands - INFO - Telegram commands set successfully.

2025-07-11 17:19:04,357 - __main__ - INFO - Telegram bot setup complete.

2025-07-11 17:19:04,415 - telegram.ext.Application - INFO - Application started

2025-07-11 17:19:09,183 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.

2025-07-11 17:19:09,184 - telegram.ext.Application - INFO - Application.stop() complete

2025-07-11 17:19:09,185 - __main__ - INFO - Application shutdown completed.

2025-07-11 17:19:09,185 - python_bot.kafka_service - INFO - Closing Kafka producer...

2025-07-11 17:19:09,185 - python_bot.kafka_service - ERROR - Error closing Kafka producer: 'cimpl.Producer' object has no attribute 'stop'
Traceback (most recent call last):
  File "/Users/ivan/prog/weather_bot/python_interface/python_bot/kafka_service.py", line 165, in close_kafka_producer
    await kafka_producer.stop()
          ^^^^^^^^^^^^^^^^^^^
AttributeError: 'cimpl.Producer' object has no attribute 'stop'
2025-07-11 17:19:09,189 - python_bot.nlp_client - INFO - HTTP client for NLP service closed.

2025-07-11 17:19:09,190 - __main__ - INFO - Closing Kafka consumer and NLP HTTP client...

2025-07-11 17:19:09,196 - python_bot.kafka_service - INFO - Kafka Consumer closed.

2025-07-11 17:19:09,197 - python_bot.nlp_client - INFO - HTTP client for NLP service closed.

2025-07-11 17:19:09,197 - __main__ - INFO - Application shut down cleanly.

2025-07-11 17:21:49,543 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.

2025-07-11 17:21:49,568 - python_bot.kafka_service - INFO - Kafka Producer connected to localhost:9092, topic='bot_commands'

2025-07-11 17:21:49,568 - python_bot.kafka_service - INFO - Kafka Consumer subscribed to topic 'bot_responses'

2025-07-11 17:21:49,568 - __main__ - INFO - Kafka Response Listener starting in separate thread.

2025-07-11 17:21:49,568 - __main__ - INFO - Telegram bot started polling...

2025-07-11 17:21:49,899 - python_bot.commands - INFO - Telegram commands set successfully.

2025-07-11 17:21:49,899 - __main__ - INFO - Telegram bot setup complete.

2025-07-11 17:21:49,944 - telegram.ext.Application - INFO - Application started

2025-07-11 17:21:55,176 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.

2025-07-11 17:21:55,177 - telegram.ext.Application - INFO - Application.stop() complete

2025-07-11 17:21:55,177 - __main__ - INFO - Application shutdown completed.

2025-07-11 17:21:55,178 - python_bot.kafka_service - INFO - Closing Kafka producer...

2025-07-11 17:21:55,178 - python_bot.kafka_service - INFO - Kafka producer closed successfully.

2025-07-11 17:21:55,179 - python_bot.nlp_client - INFO - HTTP client for NLP service closed.

2025-07-11 17:21:55,180 - __main__ - INFO - Closing Kafka consumer and NLP HTTP client...

2025-07-11 17:21:55,187 - python_bot.kafka_service - INFO - Kafka Consumer closed.

2025-07-11 17:21:55,187 - python_bot.nlp_client - INFO - HTTP client for NLP service closed.

2025-07-11 17:21:55,188 - __main__ - INFO - Application shut down cleanly.

2025-07-11 17:22:12,624 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.
2025-07-11 17:22:12,649 - python_bot.kafka_service - INFO - Kafka Producer connected to localhost:9092, topic='bot_commands'
2025-07-11 17:22:12,649 - python_bot.kafka_service - INFO - Kafka Consumer subscribed to topic 'bot_responses'
2025-07-11 17:22:12,649 - __main__ - INFO - Kafka Response Listener starting in separate thread.
2025-07-11 17:22:12,650 - __main__ - INFO - Telegram bot started polling...
2025-07-11 17:22:12,968 - python_bot.commands - INFO - Telegram commands set successfully.
2025-07-11 17:22:12,968 - __main__ - INFO - Telegram bot setup complete.
2025-07-11 17:22:13,013 - telegram.ext.Application - INFO - Application started
2025-07-11 17:22:16,542 - __main__ - INFO - Bot stopped by user via KeyboardInterrupt.
2025-07-11 17:22:16,542 - __main__ - INFO - Closing Kafka consumer and NLP HTTP client...
2025-07-11 17:22:16,552 - python_bot.kafka_service - INFO - Kafka Consumer closed.
2025-07-11 17:22:16,553 - python_bot.nlp_client - INFO - HTTP client for NLP service closed.
2025-07-11 17:22:16,557 - __main__ - INFO - Application shut down cleanly.
2025-07-11 17:35:04,396 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.
2025-07-11 17:35:04,422 - python_bot.kafka_service - INFO - Kafka Producer connected to localhost:9092, topic='bot_commands'
2025-07-11 17:35:04,423 - python_bot.kafka_service - INFO - Kafka Consumer subscribed to topic 'bot_responses'
2025-07-11 17:35:04,423 - __main__ - INFO - Kafka Response Listener starting in separate thread.
2025-07-11 17:35:04,423 - __main__ - INFO - Telegram bot started polling...
2025-07-11 17:35:04,740 - python_bot.commands - INFO - Telegram commands set successfully.
2025-07-11 17:35:04,740 - __main__ - INFO - Telegram bot setup complete.
2025-07-11 17:35:04,788 - telegram.ext.Application - INFO - Application started
2025-07-11 17:35:07,997 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.
2025-07-11 17:35:08,010 - python_bot.kafka_service - INFO - Kafka Producer connected to localhost:9092, topic='bot_commands'
2025-07-11 17:35:08,011 - python_bot.kafka_service - INFO - Kafka Consumer subscribed to topic 'bot_responses'
2025-07-11 17:35:08,011 - __main__ - INFO - Kafka Response Listener starting in separate thread.
2025-07-11 17:35:08,011 - __main__ - INFO - Telegram bot started polling...
2025-07-11 17:35:08,466 - python_bot.commands - INFO - Telegram commands set successfully.
2025-07-11 17:35:08,466 - __main__ - INFO - Telegram bot setup complete.
2025-07-11 17:35:08,511 - telegram.ext.Application - INFO - Application started
2025-07-11 17:35:08,794 - telegram.ext.Application - ERROR - No error handlers are registered, logging exception.
Traceback (most recent call last):
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/ext/_utils/networkloop.py", line 115, in network_retry_loop
    if not await do_action():
           ^^^^^^^^^^^^^^^^^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/ext/_utils/networkloop.py", line 108, in do_action
    return action_cb_task.result()
           ~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/ext/_updater.py", line 340, in polling_action_cb
    updates = await self.bot.get_updates(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/ext/_extbot.py", line 669, in get_updates
    updates = await super().get_updates(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/_bot.py", line 4610, in get_updates
    await self._post(
    ^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    ),
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/_bot.py", line 697, in _post
    return await self._do_post(
           ^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/ext/_extbot.py", line 369, in _do_post
    return await super()._do_post(
           ^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/_bot.py", line 726, in _do_post
    result = await request.post(
             ^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/request/_baserequest.py", line 197, in post
    result = await self._request_wrapper(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/request/_baserequest.py", line 374, in _request_wrapper
    raise exception
telegram.error.Conflict: Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-07-11 17:35:12,464 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'погода питер'
2025-07-11 17:35:12,469 - python_bot.nlp_client - ERROR - HTTP request error to NLP service for URL('http://localhost:8000/process_text'): All connection attempts failed
2025-07-11 17:35:12,470 - python_bot.nlp_text_handler - INFO - NLP recognized intent: nlp_error, entities: {'error_type': 'request_error', 'details': 'All connection attempts failed'}
2025-07-11 17:35:12,470 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752244512, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "nlp_error", "original_text": "погода питер", "entities": {"error_type": "request_error", "details": "All connection attempts failed"}}}
2025-07-11 17:35:12,470 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'
2025-07-11 17:35:16,425 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'погода питер'
2025-07-11 17:35:16,427 - python_bot.nlp_client - ERROR - HTTP request error to NLP service for URL('http://localhost:8000/process_text'): All connection attempts failed
2025-07-11 17:35:16,427 - python_bot.nlp_text_handler - INFO - NLP recognized intent: nlp_error, entities: {'error_type': 'request_error', 'details': 'All connection attempts failed'}
2025-07-11 17:35:16,428 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752244512, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "nlp_error", "original_text": "погода питер", "entities": {"error_type": "request_error", "details": "All connection attempts failed"}}}
2025-07-11 17:35:16,428 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'
2025-07-11 17:35:21,558 - telegram.ext.Application - ERROR - No error handlers are registered, logging exception.
Traceback (most recent call last):
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/ext/_utils/networkloop.py", line 115, in network_retry_loop
    if not await do_action():
           ^^^^^^^^^^^^^^^^^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/ext/_utils/networkloop.py", line 108, in do_action
    return action_cb_task.result()
           ~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/ext/_updater.py", line 340, in polling_action_cb
    updates = await self.bot.get_updates(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/ext/_extbot.py", line 669, in get_updates
    updates = await super().get_updates(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/_bot.py", line 4610, in get_updates
    await self._post(
    ^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    ),
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/_bot.py", line 697, in _post
    return await self._do_post(
           ^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/ext/_extbot.py", line 369, in _do_post
    return await super()._do_post(
           ^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/_bot.py", line 726, in _do_post
    result = await request.post(
             ^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/request/_baserequest.py", line 197, in post
    result = await self._request_wrapper(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/request/_baserequest.py", line 374, in _request_wrapper
    raise exception
telegram.error.Conflict: Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-07-11 17:35:29,242 - telegram.ext.Application - ERROR - No error handlers are registered, logging exception.
Traceback (most recent call last):
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/ext/_utils/networkloop.py", line 115, in network_retry_loop
    if not await do_action():
           ^^^^^^^^^^^^^^^^^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/ext/_utils/networkloop.py", line 108, in do_action
    return action_cb_task.result()
           ~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/ext/_updater.py", line 340, in polling_action_cb
    updates = await self.bot.get_updates(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/ext/_extbot.py", line 669, in get_updates
    updates = await super().get_updates(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/_bot.py", line 4610, in get_updates
    await self._post(
    ^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    ),
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/_bot.py", line 697, in _post
    return await self._do_post(
           ^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/ext/_extbot.py", line 369, in _do_post
    return await super()._do_post(
           ^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/_bot.py", line 726, in _do_post
    result = await request.post(
             ^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/request/_baserequest.py", line 197, in post
    result = await self._request_wrapper(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/request/_baserequest.py", line 374, in _request_wrapper
    raise exception
telegram.error.Conflict: Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-07-11 17:35:36,865 - telegram.ext.Application - ERROR - No error handlers are registered, logging exception.
Traceback (most recent call last):
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/ext/_utils/networkloop.py", line 115, in network_retry_loop
    if not await do_action():
           ^^^^^^^^^^^^^^^^^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/ext/_utils/networkloop.py", line 108, in do_action
    return action_cb_task.result()
           ~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/ext/_updater.py", line 340, in polling_action_cb
    updates = await self.bot.get_updates(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/ext/_extbot.py", line 669, in get_updates
    updates = await super().get_updates(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/_bot.py", line 4610, in get_updates
    await self._post(
    ^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    ),
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/_bot.py", line 697, in _post
    return await self._do_post(
           ^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/ext/_extbot.py", line 369, in _do_post
    return await super()._do_post(
           ^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/_bot.py", line 726, in _do_post
    result = await request.post(
             ^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/request/_baserequest.py", line 197, in post
    result = await self._request_wrapper(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "/Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/telegram/request/_baserequest.py", line 374, in _request_wrapper
    raise exception
telegram.error.Conflict: Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-07-11 17:35:49,769 - __main__ - INFO - Bot stopped by user via KeyboardInterrupt.
2025-07-11 17:35:49,770 - __main__ - INFO - Closing Kafka consumer and NLP HTTP client...
2025-07-11 17:35:49,773 - python_bot.kafka_service - INFO - Kafka Consumer closed.
2025-07-11 17:35:49,774 - python_bot.nlp_client - INFO - HTTP client for NLP service closed.
2025-07-11 17:35:49,774 - __main__ - INFO - Application shut down cleanly.
2025-07-11 17:35:51,095 - __main__ - INFO - Bot stopped by user via KeyboardInterrupt.
2025-07-11 17:35:51,095 - __main__ - INFO - Closing Kafka consumer and NLP HTTP client...
2025-07-11 17:35:51,098 - python_bot.kafka_service - INFO - Kafka Consumer closed.
2025-07-11 17:35:51,098 - python_bot.nlp_client - INFO - HTTP client for NLP service closed.
2025-07-11 17:35:51,098 - __main__ - INFO - Application shut down cleanly.
2025-07-11 17:35:53,548 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.
2025-07-11 17:35:53,643 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data
2025-07-11 17:35:53,664 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962
2025-07-11 17:35:54,089 - pymorphy3.opencorpora_dict.wrapper - INFO - Loading dictionaries from /Users/ivan/prog/weather_bot/venv/lib/python3.13/site-packages/pymorphy3_dicts_ru/data
2025-07-11 17:35:54,102 - pymorphy3.opencorpora_dict.wrapper - INFO - format: 2.4, revision: 417150, updated: 2022-01-08T22:09:24.565962
2025-07-11 17:35:54,105 - nlp_spacy.nlp_service - INFO - Added 81 EntityRuler patterns.
2025-07-11 17:35:54,109 - nlp_spacy.nlp_service - INFO - Added 5 intent categories to SpaCy Matcher.
2025-07-11 17:35:54,110 - nlp_spacy.nlp_service - INFO - SpaCy model 'ru_core_news_sm' successfully loaded and patterns added.
2025-07-11 17:35:57,474 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.
2025-07-11 17:35:57,489 - python_bot.kafka_service - INFO - Kafka Producer connected to localhost:9092, topic='bot_commands'
2025-07-11 17:35:57,489 - python_bot.kafka_service - INFO - Kafka Consumer subscribed to topic 'bot_responses'
2025-07-11 17:35:57,489 - __main__ - INFO - Kafka Response Listener starting in separate thread.
2025-07-11 17:35:57,489 - __main__ - INFO - Telegram bot started polling...
2025-07-11 17:35:57,796 - python_bot.commands - INFO - Telegram commands set successfully.
2025-07-11 17:35:57,796 - __main__ - INFO - Telegram bot setup complete.
2025-07-11 17:35:57,840 - telegram.ext.Application - INFO - Application started
2025-07-11 17:36:00,276 - python_bot.nlp_text_handler - INFO - Processing non-command text message from user 838039854 in chat 838039854: 'погода питер'
2025-07-11 17:36:00,283 - nlp_spacy.nlp_app - INFO - Received request for text: 'погода питер'
2025-07-11 17:36:00,310 - nlp_spacy.nlp_app - INFO - Processed text: 'погода питер', result: {'command': '/weather', 'entities': {'city': 'Питер'}}
2025-07-11 17:36:00,311 - python_bot.nlp_text_handler - INFO - NLP recognized intent: /weather, entities: {'city': 'Санкт-Петербург'}
2025-07-11 17:36:00,311 - python_bot.nlp_text_handler - INFO - Kafka payload built: {"event_type": "telegram_message", "timestamp": 1752244560, "source": "telegram_bot", "data": {"user": {"user_id": 838039854, "username": "chitiverg", "first_name": "chitiverg", "chat_id": 838039854}, "command": "/weather", "original_text": "погода питер", "entities": {"city": "Санкт-Петербург"}}}
2025-07-11 17:36:00,311 - python_bot.kafka_service - INFO - Sent event 'telegram_message' from user '838039854' to Kafka topic 'bot_commands'
2025-07-11 17:37:54,161 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Извините, эта кома...
2025-07-11 17:37:54,323 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Извините, эта кома...
2025-07-11 17:37:54,467 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Извините, эта кома...
2025-07-11 17:37:54,542 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Извините, эта кома...
2025-07-11 17:37:54,632 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Извините, эта кома...
2025-07-11 17:37:54,710 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Пожалуйста, укажит...
2025-07-11 17:37:54,795 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Извините, эта кома...
2025-07-11 17:37:54,864 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Пожалуйста, укажит...
2025-07-11 17:37:54,995 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Извините, эта кома...
2025-07-11 17:37:55,083 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Погода в городе Ке...
2025-07-11 17:37:55,152 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Погода в городе Ке...
2025-07-11 17:37:55,225 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Погода в городе Пи...
2025-07-11 17:37:55,305 - python_bot.kafka_service - INFO - Received response from Kafka for user: 838039854: Извините, не удало...
2025-07-11 17:38:13,410 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
2025-07-11 17:38:13,411 - telegram.ext.Application - INFO - Application.stop() complete
2025-07-11 17:38:13,413 - __main__ - INFO - Application shutdown completed.
2025-07-11 17:38:13,413 - python_bot.kafka_service - INFO - Closing Kafka producer...
2025-07-11 17:38:13,413 - python_bot.kafka_service - INFO - Kafka producer closed successfully.
2025-07-11 17:38:13,414 - python_bot.nlp_client - INFO - HTTP client for NLP service closed.
2025-07-11 17:38:13,415 - __main__ - INFO - Closing Kafka consumer and NLP HTTP client...
2025-07-11 17:38:13,424 - python_bot.kafka_service - INFO - Kafka Consumer closed.
2025-07-11 17:38:13,425 - python_bot.nlp_client - INFO - HTTP client for NLP service closed.
2025-07-11 17:38:13,426 - __main__ - INFO - Application shut down cleanly.
2025-07-11 23:08:14,244 - root - INFO - Logging configured. Logs will be written to logs/app.log and console.
2025-07-11 23:08:14,270 - python_bot.kafka_service - INFO - Kafka Producer connected to localhost:9092, topic='bot_commands'
2025-07-11 23:08:14,271 - python_bot.kafka_service - INFO - Kafka Consumer subscribed to topic 'bot_responses'
2025-07-11 23:08:14,271 - __main__ - INFO - Kafka Response Listener starting in separate thread.
2025-07-11 23:08:14,271 - __main__ - INFO - Telegram bot started polling...
2025-07-11 23:08:14,545 - python_bot.commands - INFO - Telegram commands set successfully.
2025-07-11 23:08:14,545 - __main__ - INFO - Telegram bot setup complete.
2025-07-11 23:08:14,592 - telegram.ext.Application - INFO - Application started
2025-07-11 23:08:14,789 - python_bot.handlers - INFO - User 838039854 used command/text (via unified handler): '/weather'
2025-07-11 23:08:14,790 - python_bot.nlp_client - ERROR - HTTP request error to NLP service for URL('http://localhost:8000/process_text'): All connection attempts failed
2025-07-11 23:08:14,790 - python_bot.kafka_service - INFO - Sent event 'telegram_command' from user '838039854' to Kafka topic 'bot_commands'
2025-07-11 23:08:14,810 - python_bot.kafka_service - INFO - Received response from Kafka for user: 4365305344: Извините, не удало...
2025-07-11 23:08:15,027 - python_bot.kafka_service - ERROR - Error while sending to Telegram API user 4365305344: Chat not found
2025-07-11 23:08:38,377 - telegram.ext.Application - INFO - Application is stopping. This might take a moment.
2025-07-11 23:08:38,377 - telegram.ext.Application - INFO - Application.stop() complete
2025-07-11 23:08:38,378 - __main__ - INFO - Application shutdown completed.
2025-07-11 23:08:38,378 - python_bot.kafka_service - INFO - Closing Kafka producer...
2025-07-11 23:08:38,378 - python_bot.kafka_service - INFO - Kafka producer closed successfully.
2025-07-11 23:08:38,380 - python_bot.nlp_client - INFO - HTTP client for NLP service closed.
2025-07-11 23:08:38,380 - __main__ - INFO - Closing Kafka consumer and NLP HTTP client...
2025-07-11 23:08:38,384 - python_bot.kafka_service - INFO - Kafka Consumer closed.
2025-07-11 23:08:38,385 - python_bot.nlp_client - INFO - HTTP client for NLP service closed.
2025-07-11 23:08:38,385 - __main__ - INFO - Application shut down cleanly.
